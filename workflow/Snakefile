snakemake.utils.min_version("6.3")
configfile: "config.yml"
include: "rules/common.smk"
include: "rules/install.smk"
include: "rules/simulate.smk"
include: "rules/la_and_vcf.smk"
include: "rules/genotype_error.smk"
include: "rules/phasing.smk"
include: "rules/analysis.smk"
include: "rules/diagnostic_plots.smk"
wildcard_constraints:
    anal_name="\w+"


rule short_run:
	input:
		rfmix2 = [f'results/{u.model_name}/{u.sim_name}/{u.anal_name}/RFMix2/rfmix2.fb.tsv' for u in units.query('anal_name == "short_run"').itertuples()],
		rfmix2_diploid = [f'results/{u.model_name}/{u.sim_name}/{u.anal_name}/RFMix2/diploid_la.hdf' for u in units.query('anal_name == "short_run"').itertuples()],
		even_more = 'results/AmericanAdmixture_4B11/AA_42/short_run/MOSAIC/la_probabilites.3way_1-2_22-22_1204_60_0.99_100.RData'


rule long_run:
	input:
		rfmix2 = [f'results/{u.model_name}/{u.sim_name}/{u.anal_name}/RFMix2/rfmix2.fb.tsv' for u in units.query('anal_name == "long_run"').itertuples()],
		rfmix2_diploid = [f'results/{u.model_name}/{u.sim_name}/{u.anal_name}/RFMix2/diploid_la.hdf' for u in units.query('anal_name == "long_run"').itertuples()],
		even_more = 'results/AmericanAdmixture_4B11/AA_42/long_run/MOSAIC/la_probabilites.3way_1-200_22-22_1600_60_0.99_100.RData'


rule diagnostic_plots:
	input:
		pop_coal_time = [f'results/{u.model_name}/{u.sim_name}/{u.anal_name}/DIAGNOSTIC/pop_coal_time.png' for u in units.itertuples()],
		pairwise_Fst = [f'results/{u.model_name}/{u.sim_name}/{u.anal_name}/DIAGNOSTIC/pairwise_Fst.png' for u in units.itertuples()],
		true_local_ancestry = [f'results/{u.model_name}/{u.sim_name}/{u.anal_name}/DIAGNOSTIC/true_local_ancestry.png' for u in units.itertuples()]


rule test_bmix:
	input:
		[f'results/{u.model_name}/{u.sim_name}/{u.anal_name}/bmix/bmix.anc.vcf.gz' for u in units.query('anal_name == "short_run"').itertuples()],
